<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Send comments to: Tony T (adthral)">

<title>4&nbsp; Statistical Simulation – EDA for Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./study-design.html" rel="next">
<link href="./clustering.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./eda.html">Statistics</a></li><li class="breadcrumb-item"><a href="./simulation.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Statistical Simulation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">EDA for Machine Learning</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/tthrall/eda4ml/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conditioning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Conditional Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Clustering: EDA in Higher Dimensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Statistical Simulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./study-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Sampling and Study Design</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Linear Algebra</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./la-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Some Linear Algebra</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reduce-dim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Text Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Text Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dirichlet-dstn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The Dirichlet Distribution</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./latent-dirichlet-alloc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Latent Dirichlet Allocation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Time Series Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ts-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time Series Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ts-forecast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Time Series Forecasting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ts-fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Time Series Spectrum Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Graph Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graph-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Graph Theory for Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./em-algorithm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">EM: the Expectation-Maximization Algorithm</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-introduction" id="toc-sec-introduction" class="nav-link active" data-scroll-target="#sec-introduction"><span class="header-section-number">4.1</span> Introduction</a></li>
  <li><a href="#sec-rng" id="toc-sec-rng" class="nav-link" data-scroll-target="#sec-rng"><span class="header-section-number">4.2</span> Generating Random Numbers from a Given Distribution</a>
  <ul class="collapse">
  <li><a href="#continuous-distributions" id="toc-continuous-distributions" class="nav-link" data-scroll-target="#continuous-distributions"><span class="header-section-number">4.2.1</span> Continuous Distributions</a></li>
  <li><a href="#discrete-distributions" id="toc-discrete-distributions" class="nav-link" data-scroll-target="#discrete-distributions"><span class="header-section-number">4.2.2</span> Discrete Distributions</a></li>
  </ul></li>
  <li><a href="#sec-mean-v-median-example" id="toc-sec-mean-v-median-example" class="nav-link" data-scroll-target="#sec-mean-v-median-example"><span class="header-section-number">4.3</span> Example Application</a></li>
  <li><a href="#sec-class-exr" id="toc-sec-class-exr" class="nav-link" data-scroll-target="#sec-class-exr"><span class="header-section-number">4.4</span> Class Exercise</a></li>
  <li><a href="#sec-mc-sim" id="toc-sec-mc-sim" class="nav-link" data-scroll-target="#sec-mc-sim"><span class="header-section-number">4.5</span> Monte Carlo Simulation</a>
  <ul class="collapse">
  <li><a href="#sec-est-pi" id="toc-sec-est-pi" class="nav-link" data-scroll-target="#sec-est-pi"><span class="header-section-number">4.5.1</span> Example 1: estimate <span class="math inline">\(\pi\)</span></a></li>
  <li><a href="#sec-est-area" id="toc-sec-est-area" class="nav-link" data-scroll-target="#sec-est-area"><span class="header-section-number">4.5.2</span> Example 2: estimate area of an arbitrary region</a></li>
  <li><a href="#importance-sampling-art-importance-sampling" id="toc-importance-sampling-art-importance-sampling" class="nav-link" data-scroll-target="#importance-sampling-art-importance-sampling"><span class="header-section-number">4.5.3</span> Importance Sampling </a></li>
  </ul></li>
  <li><a href="#sec-mcmc" id="toc-sec-mcmc" class="nav-link" data-scroll-target="#sec-mcmc"><span class="header-section-number">4.6</span> Markov Chain Monte Carlo (MCMC) </a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="header-section-number">4.6.1</span> Overview</a></li>
  <li><a href="#markov-chains" id="toc-markov-chains" class="nav-link" data-scroll-target="#markov-chains"><span class="header-section-number">4.6.2</span> Markov chains</a></li>
  <li><a href="#time-reversal" id="toc-time-reversal" class="nav-link" data-scroll-target="#time-reversal"><span class="header-section-number">4.6.3</span> Time Reversal</a></li>
  <li><a href="#metropolis-hastings-algorithmart-mh-algo" id="toc-metropolis-hastings-algorithmart-mh-algo" class="nav-link" data-scroll-target="#metropolis-hastings-algorithmart-mh-algo"><span class="header-section-number">4.6.4</span> Metropolis-Hastings Algorithm</a></li>
  </ul></li>
  <li><a href="#sec-team-exr" id="toc-sec-team-exr" class="nav-link" data-scroll-target="#sec-team-exr"><span class="header-section-number">4.7</span> Team Exercises</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">4.8</span> Resources</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/tthrall/eda4ml/edit/main/simulation.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/tthrall/eda4ml/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./eda.html">Statistics</a></li><li class="breadcrumb-item"><a href="./simulation.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Statistical Simulation</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-simulation" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Statistical Simulation</span></span></h1>
<p class="subtitle lead">Part 1, session 3b of Data Mining Intro</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Send comments to: Tony T (adthral) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">20:55 Tue 14-Oct-2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    Introduce basic ideas and methods of statistical simulation studies. <br><br>
  </div>
</div>


</header>


<hr>
<section id="sec-introduction" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-introduction"><span class="header-section-number">4.1</span> Introduction</h2>
<p>Statistical simulation generates random data from specified distributions in order to model the behavior of complex systems and analyze potential outcomes of various scenarios. Simulations augment analytic solutions, enabling researchers to explore different possibilities and assess alternative methods. Here are some of the uses of statistical simulation.</p>
<ul>
<li>Comparing statistical methods</li>
<li>Assessing the robustness of data analyses</li>
<li>Understanding system behavior</li>
<li>Supplementing real-world data</li>
</ul>
</section>
<section id="sec-rng" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-rng"><span class="header-section-number">4.2</span> Generating Random Numbers from a Given Distribution</h2>
<p>As mentioned in an earlier session, the R <code>stats</code> package provides random number generators for commonly used probability distributions. For each random number generator the package also provides the probability density function (for continuous distributions) or the probability mass function (for discrete distributions), along with cumulative versions (incomplete integrals or sums), and the inverse of the cumulative versions, the quantile functions. The naming convention is illustrated by the uniform distribution over a finite interval (unit interval by default).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<ul>
<li><code>dunif()</code> density at a given point <span class="math inline">\(x\)</span></li>
<li><code>punif()</code> cumulative probability, that <span class="math inline">\(X \le x\)</span></li>
<li><code>qunif()</code> quantile, return <span class="math inline">\(x\)</span> having prescribed cumulative probability <span class="math inline">\(p\)</span></li>
<li><code>runif()</code> generate indpendent instances <span class="math inline">\((X_1, \ldots, X_n)\)</span> of a uniform random variable</li>
</ul>
<section id="continuous-distributions" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="continuous-distributions"><span class="header-section-number">4.2.1</span> Continuous Distributions</h3>
<p>The <code>stats</code> package includes the following continuous distributions.</p>
<div class="cell">
<div id="tbl-dpqr-tbl" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-dpqr-tbl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.1: Continuous Distributions from <code>stats</code>
</figcaption>
<div aria-describedby="tbl-dpqr-tbl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Continuous Distributions from <code>stats</code></caption>
<thead>
<tr class="header">
<th style="text-align: left;">prefix</th>
<th style="text-align: left;">suffix</th>
<th style="text-align: left;">distribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">beta</td>
<td style="text-align: left;">Beta</td>
</tr>
<tr class="even">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">cauchy</td>
<td style="text-align: left;">Cauchy</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">chisq</td>
<td style="text-align: left;">(non-central) Chi-Squared</td>
</tr>
<tr class="even">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">exp</td>
<td style="text-align: left;">Exponential</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">f</td>
<td style="text-align: left;">F</td>
</tr>
<tr class="even">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">gamma</td>
<td style="text-align: left;">Gamma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">lnorm</td>
<td style="text-align: left;">Log Normal</td>
</tr>
<tr class="even">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">logis</td>
<td style="text-align: left;">Logistic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">norm</td>
<td style="text-align: left;">Normal</td>
</tr>
<tr class="even">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">t</td>
<td style="text-align: left;">Student t</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">unif</td>
<td style="text-align: left;">Uniform</td>
</tr>
<tr class="even">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">weibull</td>
<td style="text-align: left;">Weibull</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>These distributions have interesting histories and relationships.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> For example a beta variable <span class="math inline">\(X\)</span> having shape parameters <span class="math inline">\((\alpha, \beta)\)</span> can be expressed as the ratio <span class="math inline">\(U/(U + V)\)</span>, where <span class="math inline">\((U, V)\)</span> are independent gamma variables having a common scale parameter, and respective shape parameters <span class="math inline">\((\alpha, \beta)\)</span>. See the resources listed below if interested.</p>
</section>
<section id="discrete-distributions" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="discrete-distributions"><span class="header-section-number">4.2.2</span> Discrete Distributions</h3>
<p>The <code>stats</code> package also includes the following discrete distributions.</p>
<div class="cell">
<div id="tbl-dpqr-int" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-dpqr-int-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.2: Discrete Distributions from <code>stats</code>
</figcaption>
<div aria-describedby="tbl-dpqr-int-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Discrete Distributions from <code>stats</code></caption>
<thead>
<tr class="header">
<th style="text-align: left;">prefix</th>
<th style="text-align: left;">suffix</th>
<th style="text-align: left;">distribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">binom</td>
<td style="text-align: left;">Binomial</td>
</tr>
<tr class="even">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">geom</td>
<td style="text-align: left;">Geometric</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">hyper</td>
<td style="text-align: left;">Hypergeometric</td>
</tr>
<tr class="even">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">nbinom</td>
<td style="text-align: left;">Negative Binomial</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[d, p, q, r]</td>
<td style="text-align: left;">pois</td>
<td style="text-align: left;">Poisson</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Again, these distributions have interesting histories and relationships. For example the Poisson distribution can described as the limiting case of binomial distributions, <span class="math inline">\(\text{Binom}(n, p_n)\)</span> such that the respective expected values, <span class="math inline">\(n \times p_n\)</span>, converge to <span class="math inline">\(\lambda &gt; 0\)</span> as <span class="math inline">\(n \rightarrow \infty\)</span>. Equivalently we can write <span class="math inline">\(p_n \approx \lambda/n\)</span>, so that <span class="math inline">\(p_n\)</span>, the probability of success on a single Bernoulli trial, becomes vanishingly small as the number <span class="math inline">\(n\)</span> of Bernoulli trials increases. For this reason the Poisson distribution has been called “the law of rare events”.</p>
</section>
</section>
<section id="sec-mean-v-median-example" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-mean-v-median-example"><span class="header-section-number">4.3</span> Example Application</h2>
<p>Statistical simulation has been used to evaluate proposed statistical methods. Here’s an admittedly tame example (where the answer has already been determined mathematically).</p>
<p>Let <span class="math inline">\(\hat{\mathcal{m}}\)</span> and <span class="math inline">\(\hat{\mu}\)</span> denote the median and mean, respectively, of a random sample from a continuous distribution. For a symmetric distribution (with a defined population mean value), the population median and mean coincide. But the sample mean is highly sensitive to a few outlying values in the sample, and is thus less robust than the sample median for long-tailed distributions.</p>
<p>Consequently, in financial applications and other applications where long-tailed distributions occur, the median is the preferred descriptor of the central value of the sample and of the population.</p>
<p>In some cases the robustness of the sample median comes at a cost. If the population distribution is normal with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span> then the sample mean has smaller variance than the sample median (although they estimate the same population value).</p>
<p><span id="eq-variance-mean-v-median"><span class="math display">\[
\begin{align}
  \text{Var} \left\{ \hat{\mu} \right\} &amp;= \frac{\sigma^2}{n} \\
  \\
  \text{Var} \left\{ \hat{\mathcal{m}} \right\} &amp;= \frac{\pi}{2} \frac{\sigma^2}{n + 1} \\
  \\
  \frac{ \text{Var} \left\{ \hat{\mathcal{m}} \right\} }{ \text{Var} \left\{ \hat{\mu} \right\} } &amp;\approx \frac{\pi}{2} \\
  &amp;\approx 1.57
\end{align}
\qquad(4.1)\]</span></span></p>
<p>This ratio of variances in the normal case can be verified by simulation.</p>
<p>In this example, simulation would merely illustrate a property already determined mathematically. But in other situations, statistical simulation may be the best practical way to understand the properties of a proposed statistical procedure, or more generally, a system that entails random events.</p>
</section>
<section id="sec-class-exr" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="sec-class-exr"><span class="header-section-number">4.4</span> Class Exercise</h2>
<p>With a teammate, generate a sample of <span class="math inline">\(n\)</span> pseudo-random numbers following the normal distribution, for example using <code>stats::rnorm()</code>. Calculate <span class="math inline">\(\hat{\mathcal{m}}\)</span> and <span class="math inline">\(\hat{\mu}\)</span>, the sample <code>median()</code> and <code>mean()</code>. Now repeat that process a total of <span class="math inline">\(R\)</span> times, recording the values of the sample mean and median in each run. This gives a sample of size <span class="math inline">\(R\)</span> of the pair <span class="math inline">\((\hat{\mathcal{m}}, \hat{\mu})\)</span>. What is the sample variance of these two estimators? Take 20 minutes to prepare to report your progress to the class.</p>
</section>
<section id="sec-mc-sim" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="sec-mc-sim"><span class="header-section-number">4.5</span> Monte Carlo Simulation</h2>
<p>Monte Carlo simulation encompasses a broad set of algorithms that use random sampling to obtain numerical values. Mathematician <a href="https://en.wikipedia.org/wiki/Stanis%C5%82aw_Ulam">Stanislav Ulam</a> led the development of this approach (and coined the name) as part of the Manhattan Project during World War 2. The approach is used when other types of numerical calculation are not feasible.</p>
<section id="sec-est-pi" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="sec-est-pi"><span class="header-section-number">4.5.1</span> Example 1: estimate <span class="math inline">\(\pi\)</span></h3>
<p>Here is a simple illustration. Recall that a circle of radius <span class="math inline">\(r\)</span> has an area equal to <span class="math inline">\(\pi \; r^2\)</span>. Setting <span class="math inline">\(r = 1\)</span> we see that the unit circle has an area equal to <span class="math inline">\(\pi\)</span>. Centered at the origin of the plane, the area is divided equally among the four quadrants of the plane. Thus the area within the first quadrant equals <span class="math inline">\(\pi/4\)</span>. We can use random sampling to estimate <span class="math inline">\(\pi\)</span> as follows.</p>
<ol type="1">
<li>Generate pairs of independent standard uniform random variables <span class="math inline">\(\{ (X_j, Y_j) \}_{j = 1}^n\)</span>. They constitute uniformly random points in the unit square.</li>
<li>Define <span class="math inline">\(B_j\)</span> to be the Bernoulli indicator function, equal to 1 if <span class="math inline">\(X_j^2 + Y_j^2 &lt; 1\)</span> and equal to zero otherwise. Note that <span class="math inline">\(B_j\)</span> has expected value <span class="math inline">\(\pi/4\)</span>.</li>
<li>Calculate the sample average <span class="math inline">\(A(B_{\bullet})\)</span> as an estimate of <span class="math inline">\(\pi/4\)</span>.</li>
<li>Multiply the sample average by 4 as an estimate of <span class="math inline">\(\pi\)</span>.</li>
</ol>
<p>The precision of the estimate improves as the number <span class="math inline">\(n\)</span> of randomly generated points increases.</p>
</section>
<section id="sec-est-area" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="sec-est-area"><span class="header-section-number">4.5.2</span> Example 2: estimate area of an arbitrary region</h3>
<p>The figure below shows a simple closed curve within the unit square centered at the origin.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-c-tbl" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-c-tbl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simulation_files/figure-html/fig-c-tbl-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-c-tbl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Monte Carlo estimation of area
</figcaption>
</figure>
</div>
</div>
</div>
<p>The closed curve defines an interior region <span class="math inline">\(\mathcal{R}\)</span> bounded by the square <span class="math inline">\(\mathcal{S} = [-0.5, 0.5] \times [-0.5, 0.5]\)</span>. We assume that for any point <span class="math inline">\((x, y) \in \mathcal{S}\)</span> we can determine whether the point is inside or outside <span class="math inline">\(\mathcal{R}\)</span>. The Monte Carlo estimate of the area of this region is the proportion of points randomly selected from <span class="math inline">\(\mathcal{S}\)</span> that fall within <span class="math inline">\(\mathcal{R}\)</span> multiplied by the area of <span class="math inline">\(\mathcal{S}\)</span> (which is 1 in this case).</p>
<p>In the current example, the closed curve shown above is a deformation of the unit circle in which the Euclidean norm at each point, <span class="math inline">\(t\)</span>, along the circle has been multiplied by a prescribed positive continuous function, <span class="math inline">\(f(t)\)</span>. Consequently a point <span class="math inline">\((x, y)\)</span> is in the interior of the closed curve if <span class="math inline">\(x^2 + y^2 &lt; f^2(t)\)</span>, where <span class="math inline">\(t \in [0,1)\)</span> equals <span class="math inline">\(\arctan(y, x) \bmod{2 \pi}\)</span>.</p>
<p>This is a common application of Mote Carlo simulation: estimating the volume of given region <span class="math inline">\(\mathcal{R}\)</span> in Euclidean space, under the assumption that, for any given point, we can determine whether the point is inside or outside the region.</p>
</section>
<section id="importance-sampling-art-importance-sampling" class="level3" data-number="4.5.3">
<h3 data-number="4.5.3" class="anchored" data-anchor-id="importance-sampling-art-importance-sampling"><span class="header-section-number">4.5.3</span> Importance Sampling <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></h3>
<p>The above description of Monte Carlo simulation is also called rejection sampling, and can be generalized as follows. Let <span class="math inline">\(\mathcal{R}\)</span> denote a region of <span class="math inline">\(\mathbb{R}^d\)</span> having a finite volume <span class="math inline">\(| \mathcal{R} |\)</span>. We want to estimate the average value, <span class="math inline">\(\mu(f, \mathcal{R})\)</span> of any given integrable function <span class="math inline">\(f: \mathcal{R} \rightarrow \mathbb{R}\)</span>.</p>
<p><span id="eq-mu-f-region"><span class="math display">\[
\begin{align}
  \mu(f, \mathcal{R}) &amp;= \frac{1}{| \mathcal{R} |} \int_\mathcal{R} f(x) \; dx
\end{align}
\qquad(4.2)\]</span></span></p>
<p>This corresponds to the expected value of <span class="math inline">\(f(X)\)</span> when the random vector <span class="math inline">\(X\)</span> has a uniform probability distribution over <span class="math inline">\(\mathcal{R}\)</span>. More generally, suppose we also have some probability density function <span class="math inline">\(p(\cdot)\)</span> restricted to <span class="math inline">\(\mathcal{R}\)</span>, and we want to calculate the expected value of <span class="math inline">\(f(X)\)</span> when <span class="math inline">\(X\)</span> has probability density <span class="math inline">\(p(\cdot)\)</span>.</p>
<p><span id="eq-mu-f-p"><span class="math display">\[
\begin{align}
  \mu(f, p) &amp;= \int_\mathcal{R} f(x) \times p(x) \; dx
\end{align}
\qquad(4.3)\]</span></span></p>
<p>Now. it may not be convenient or feasible to generate a random sample of vectors <span class="math inline">\(\{ X_1, \ldots, X_n \}\)</span> from the probability distribution having given density function <span class="math inline">\(p(\cdot)\)</span>. But we may be able to generate a random sample of vectors <span class="math inline">\(\{ Y_1, \ldots, Y_n \}\)</span> from a density function <span class="math inline">\(q(\cdot)\)</span> defined on a region <span class="math inline">\(\mathcal{S}\)</span> containing <span class="math inline">\(\mathcal{R}\)</span>. Then <span class="math inline">\(\mu(f, p)\)</span> can be expressed as the following weighted expectation of <span class="math inline">\(f(Y)\)</span>.</p>
<p><span id="eq-mu-w-f-q"><span class="math display">\[
\begin{align}
  \mu(f, p) &amp;= \int_\mathcal{R} w(y) \times f(y) \times q(y) \; dy  \\ \\
  &amp; \text{where } \\ \\
  w(y) &amp;= \frac{p(y)}{q(y)}
\end{align}
\qquad(4.4)\]</span></span></p>
<p>The estimated value takes the form of the following weighted sum.</p>
<p><span id="eq-avg-w-f-q"><span class="math display">\[
\begin{align}
  \hat{\mu}(f, p) &amp;= \frac{\sum_{j = 1}^n w(Y_j) \; f(Y_j)}
  {\sum_{k = 1}^n w(Y_k)}
\end{align}
\qquad(4.5)\]</span></span></p>
<p>This approach is called <em>importance sampling</em>, and has many variations.</p>
<p>Example: Suppose <span class="math inline">\(Z\)</span> has a standard normal distribution with density function <span class="math inline">\(\phi(\cdot)\)</span> and cumulative probability function <span class="math inline">\(\Phi(\cdot)\)</span>, and we want to determine the following conditional expectation.</p>
<p><span id="eq-mu-f-z-conditional"><span class="math display">\[
\begin{align}
  \mu(f, p) &amp;= E \left \{ f(Z) \; | \; Z \ge 6  \right \} \\
  &amp;= \int_\mathcal{R} f(z) \times p(z) \; dz \\ \\
  &amp; \text{where } \\ \\
  \mathcal{R} &amp;= \{ z \; : \; z \ge 6 \} \\
  p(z) &amp;=
  \begin{cases}
    0 &amp; \text{if } z &lt; 6 \\
    \frac{\phi(z)}{1 - \Phi(6)} &amp; \text{if } z \ge 6
  \end{cases}
\end{align}
\qquad(4.6)\]</span></span></p>
<p>A naive approach to estimating <span class="math inline">\(\mu(f, p)\)</span> would be to generate standard normal variables <span class="math inline">\(\{ Z_1, \ldots, Z_n \}\)</span>, rejecting those values less than 6, and then averaging <span class="math inline">\(f(Z_\nu)\)</span> across the remaining values. The problem is that we would expect only one in a billion values to pass this threshhold, making that algorithm highly inefficient.</p>
<p>Alternatively, we could define <span class="math inline">\(Y_\nu = 12 | Z_\nu |\)</span>, and apply the weighted averaging of <a href="#eq-avg-w-f-q" class="quarto-xref">Equation&nbsp;<span>4.5</span></a>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p><span id="eq-mu-f-z-conditional"><span class="math display">\[
\begin{align}
  w(y) &amp;= \frac{p(y)}{q(y)} \\ \\
  &amp; \text{where } \\ \\
  p(y) &amp;=
  \begin{cases}
    0 &amp; \text{if } z &lt; 6 \\
    \frac{\phi(y)}{1 - \Phi(6)} &amp; \text{if } z \ge 6
  \end{cases} \\
  q(y) &amp;= \frac{2}{12} \; \phi \left ( \frac{y}{12} \right )
\end{align}
\qquad(4.7)\]</span></span></p>
<p>This weighting function <span class="math inline">\(w(\cdot)\)</span> rapidly decreases on the interval <span class="math inline">\(y \in [6, \infty)\)</span> and otherwise assigns zero weight.</p>
</section>
</section>
<section id="sec-mcmc" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="sec-mcmc"><span class="header-section-number">4.6</span> Markov Chain Monte Carlo (MCMC) <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></h2>
<section id="overview" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">4.6.1</span> Overview</h3>
<p>Markov Chain Monte Carlo (MCMC) simulation encompasses many variations. The basic problem to be addressed is the same as that of importance sampling:</p>
<ul>
<li><p>We would like to generate a random sample from a distribution having given density, <span class="math inline">\(p(x), x \in \mathbb{R}^d\)</span>.</p></li>
<li><p>We cannot directly generate the desired random sample, although we can evaluate <span class="math inline">\(p(x)\)</span> for any given <span class="math inline">\(x \in \mathbb{R}^d\)</span>.</p></li>
</ul>
<p>The approach toward a solution can be framed as follows.</p>
<ul>
<li><p>Construct a Markov chain <span class="math inline">\(X: \mathbb{Z} \rightarrow \mathbb{R}^d\)</span> (a discrete-time random process) having a stationary distribution (to which <span class="math inline">\(X(\cdot)\)</span> converges) given by density <span class="math inline">\(p(\cdot)\)</span>.</p></li>
<li><p>Generate a sufficient number <span class="math inline">\(n\)</span> of samples from <span class="math inline">\(X(\cdot)\)</span> so that <span class="math inline">\(\{ X(n), X(n+1), \ldots \}\)</span> approximates a sample from the desired stationary distribution.</p></li>
</ul>
</section>
<section id="markov-chains" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="markov-chains"><span class="header-section-number">4.6.2</span> Markov chains</h3>
<p>Recall the definition of a Markov chain, <span class="math inline">\(X(\cdot)\)</span>. The conditional distribution of <span class="math inline">\(X(t)\)</span> given past values, <span class="math inline">\(X(t-1), X(t-2), \ldots\)</span>, is just the conditional distribution of <span class="math inline">\(X(t)\)</span> given its preceding value, <span class="math inline">\(X(t-1)\)</span>.</p>
<p>To illustrate, suppose that the values of <span class="math inline">\(X(\cdot)\)</span> are restricted to a finite set, say <span class="math inline">\(\{ 1, 2, 3 \}\)</span>. Then we define the transition probability <span class="math inline">\(p_{a, b}\)</span> as the following conditional probability.</p>
<p><span id="eq-discrete-transition-prob"><span class="math display">\[
\begin{align}
  p_{a, b} &amp;= P(X(t) = b \; | \; X(t-1) = a)
\end{align}
\qquad(4.8)\]</span></span></p>
<p>These transition probabilities are the elements of the following transition probability matrix <span class="math inline">\(T\)</span>.</p>
<p><span id="eq-transition-matrix-example"><span class="math display">\[
\begin{align}
  T &amp;=
  \left (
  \begin{matrix}
    p_{1, 1} &amp; p_{1,2} &amp; p_{1,3} \\
    p_{2, 1} &amp; p_{2,2} &amp; p_{2,3} \\
    p_{3, 1} &amp; p_{3,2} &amp; p_{3,3}
  \end{matrix}
  \right )
\end{align}
\qquad(4.9)\]</span></span></p>
<p>If we denote the (marginal) probability distribution of <span class="math inline">\(X(n)\)</span> as <span class="math inline">\(\pi_n\)</span></p>
<p><span id="eq-marginal-prob-example"><span class="math display">\[
\begin{align}
  \pi_n &amp;= \left ( P(X(n) = 1), P(X(n) = 2), P(X(n) = 3) \right )
\end{align}
\qquad(4.10)\]</span></span></p>
<p>then we have</p>
<p><span id="eq-marginal-prob-transition"><span class="math display">\[
\begin{align}
  \pi_{n+1} &amp;= \pi_n  \; T
\end{align}
\qquad(4.11)\]</span></span></p>
<p>Consequently we have</p>
<p><span id="eq-marginal-prob-power"><span class="math display">\[
\begin{align}
  \pi_n &amp;= \pi_0  \; T^n
\end{align}
\qquad(4.12)\]</span></span></p>
<p>Under regularity conditions<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> there is a unique stationary distribution, say <span class="math inline">\(\pi_\infty\)</span>, such that <span class="math inline">\(\pi_n \rightarrow \pi_\infty\)</span>. Convergence is accompanied by diminishing values of <span class="math inline">\(\lVert \pi_{n+1} - \pi_n \rVert\)</span>.</p>
</section>
<section id="time-reversal" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="time-reversal"><span class="header-section-number">4.6.3</span> Time Reversal</h3>
<p>Recall that <span class="math inline">\(p(x)\)</span> is the prescribed stationary distribution of a Markov chain <span class="math inline">\(X(\cdot)\)</span> that we must construct. To do so, we will use the fact that if <span class="math inline">\(X(\cdot)\)</span> is time-reversible, then the marginal distribution of <span class="math inline">\(X(\nu)\)</span> is stationary. This can be seen as follows.</p>
<p><span class="math inline">\(X(\cdot)\)</span> is time-reversible if the following holds. For any given <span class="math inline">\(n &gt; 0\)</span> define <span class="math inline">\(Y(\nu) = X(n - \nu)\)</span> for <span class="math inline">\(0 \le \nu \le n\)</span>. Then the joint probability distribution of the sequence <span class="math inline">\(( X(0), \ldots, X(n) )\)</span> is equal to that of the sequence <span class="math inline">\(( Y(0), \ldots, Y(n) ) = ( X(n), \ldots, X(0) )\)</span>.</p>
<p>It follows that the ordered pair of random variables <span class="math inline">\((X(0), X(n))\)</span> has the same distribution as that of <span class="math inline">\((X(n), X(0))\)</span>, so that <span class="math inline">\(X(0)\)</span> has the same distribution as <span class="math inline">\(X(n)\)</span>, and this holds for all <span class="math inline">\(n &gt; 0\)</span>. Thus if <span class="math inline">\(X(\cdot)\)</span> is time-reversible its marginal distribution must be stationary.</p>
<p>Now assume for the moment that the values of <span class="math inline">\(X(t)\)</span> form a discrete set, so that:</p>
<p><span id="eq-balance-eqns-prep"><span class="math display">\[
\begin{align}
  P\left ( X(0) = a, X(1) = b \right ) &amp;= \pi_\infty(a) \times p_{a, b} \\
  P\left ( X(1) = a, X(0) = b \right ) &amp;= \pi_\infty(b) \times p_{b, a}
\end{align}
\qquad(4.13)\]</span></span></p>
<p>If <span class="math inline">\(X(\cdot)\)</span> is time-reversible, it follows that:</p>
<p><span id="eq-balance-eqns"><span class="math display">\[
\begin{align}
  \pi_\infty(a) \times p_{a, b} &amp;= \pi_\infty(b) \times p_{b, a}
\end{align}
\qquad(4.14)\]</span></span></p>
<p>Equations of this form are called <em>local balance equations</em>. If they hold then marginal distribution <span class="math inline">\(\pi_\infty\)</span> along with transition probabilities <span class="math inline">\(p_{a, b}\)</span> define a stationary Markov chain.</p>
</section>
<section id="metropolis-hastings-algorithmart-mh-algo" class="level3" data-number="4.6.4">
<h3 data-number="4.6.4" class="anchored" data-anchor-id="metropolis-hastings-algorithmart-mh-algo"><span class="header-section-number">4.6.4</span> Metropolis-Hastings Algorithm<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></h3>
<p>Suppose now that <span class="math inline">\(q(Y \; | \; X )\)</span> is a transition density from which we can generate a random sequence <span class="math inline">\(X(0), X(1), \ldots\)</span>, and let <span class="math inline">\(p(x)\)</span> denote the prescribed stationary distribution of <span class="math inline">\(X(\cdot)\)</span>. Also suppose that the current state of the generated sequence is <span class="math inline">\(X(t) = x\)</span>.</p>
<section id="outline" class="level4" data-number="4.6.4.1">
<h4 data-number="4.6.4.1" class="anchored" data-anchor-id="outline"><span class="header-section-number">4.6.4.1</span> Outline</h4>
<p>The Metropolis-Hastings procedure is an iterative algorithm for generating the next value of the sequence as follows.</p>
<ol type="1">
<li>Generate a candidate value <span class="math inline">\(y \sim q(Y \; | \; x )\)</span>.</li>
<li>Calculate <em>acceptance ratio</em> <span class="math inline">\(\alpha(y \; | \; x)\)</span> shown below.</li>
<li>Generate <span class="math inline">\(u \sim unif(0, 1)\)</span>. Set the next value to <span class="math inline">\(y\)</span> if <span class="math inline">\(u \le \alpha(y \; | \; x)\)</span>. Otherwise set the next value to the current value, <span class="math inline">\(x\)</span>.</li>
</ol>
<p><span id="eq-accept-ratio"><span class="math display">\[
\begin{align}
  \alpha(y \; | \; x) &amp;= \max \left \{1, \frac{ p(y) \; q(x \; | \; y) }{ p(x) \; q(y \; | \; x ) } \right \}
\end{align}
\qquad(4.15)\]</span></span></p>
</section>
<section id="metropolis-algorithm" class="level4" data-number="4.6.4.2">
<h4 data-number="4.6.4.2" class="anchored" data-anchor-id="metropolis-algorithm"><span class="header-section-number">4.6.4.2</span> Metropolis Algorithm</h4>
<p>The original algorithm, known as the Metropolis algorithm, is a simpler procedure that generates a random walk. Let <span class="math inline">\(g(\cdot)\)</span> denote a probability density function that is symmetric with respect to <span class="math inline">\(x = 0\)</span>. Given the current state <span class="math inline">\(X(t) = x\)</span>, generate the candidate value <span class="math inline">\(y\)</span> as:</p>
<p><span id="eq-Metro-next-y"><span class="math display">\[
\begin{align}
  y &amp;= x + \epsilon \\ \\
  &amp;\text{where } \\ \\
  \epsilon &amp;\sim g(\cdot)
\end{align}
\qquad(4.16)\]</span></span></p>
<p>Then the density <span class="math inline">\(q(y \; | \; x)\)</span> of the transition from <span class="math inline">\(x\)</span> to <span class="math inline">\(y = x + \epsilon\)</span> is:</p>
<p><span id="eq-Metro-transition-dens"><span class="math display">\[
\begin{align}
  q(y \; | \; x) &amp;= g(y - x)
\end{align}
\qquad(4.17)\]</span></span></p>
<p>Since <span class="math inline">\(g(\cdot)\)</span> is symmetric about zero, <span class="math inline">\(q(y \; | \; x )\)</span> is symmetric in its two arguments.</p>
<p><span id="eq-Metro-transition-symm"><span class="math display">\[
\begin{align}
  q(x \; | \; y) &amp;= g(x - y) \\
  &amp;= g(y - x) \\
  &amp;= q(y \; | \; x)
\end{align}
\qquad(4.18)\]</span></span></p>
<p>Consequently the acceptance ratio simplifies as follows.</p>
<p><span id="eq-Metro-accept-ratio"><span class="math display">\[
\begin{align}
  \alpha(y \; | \; x) &amp;= \max \left \{1, \frac{ p(y) \; q(x \; | \; y) }{ p(x) \; q(y \; | \; x ) } \right \} \\
  &amp;= \max \left \{1, \frac{ p(y) }{ p(x) } \right \}
\end{align}
\qquad(4.19)\]</span></span></p>
</section>
<section id="example" class="level4" data-number="4.6.4.3">
<h4 data-number="4.6.4.3" class="anchored" data-anchor-id="example"><span class="header-section-number">4.6.4.3</span> Example</h4>
<p>For some fixed <span class="math inline">\(\delta &gt; 0\)</span> let <span class="math inline">\(g(\cdot)\)</span> be the uniform density on the interval <span class="math inline">\((-\delta, \delta)\)</span>. Let the specified stationary distribution be given by the standard normal density function <span class="math inline">\(\phi(\cdot)\)</span>. Then the Metropolis algorithm outlined above will generate a random walk in discrete time having jump-magnitudes governed by <span class="math inline">\(\delta\)</span>.</p>
<p>The steps to generate the next value <span class="math inline">\(y\)</span> given the current value <span class="math inline">\(x\)</span> are a simplification of the steps previously outlined.</p>
<ol type="1">
<li>Generatecandidate value <span class="math inline">\(y = x + \epsilon\)</span>, where <span class="math inline">\(\epsilon \sim uniform(-\delta, \delta)\)</span>.</li>
<li>Calculate <em>acceptance ratio</em> <span class="math inline">\(\alpha(y \; | \; x)\)</span> shown below.</li>
<li>Generate <span class="math inline">\(u \sim unif(0, 1)\)</span>. Set the next value to <span class="math inline">\(y\)</span> if <span class="math inline">\(u \le \alpha(y \; | \; x)\)</span>. Otherwise set the next value to the current value, <span class="math inline">\(x\)</span>.</li>
</ol>
<p><span id="eq-Metro-accept-ratio-normal"><span class="math display">\[
\begin{align}
  \alpha(y \; | \; x) &amp;= \max \left \{1, \frac{ \phi(y) }{ \phi(x) } \right \}
\end{align}
\qquad(4.20)\]</span></span></p>
<p>Here are three simulations, each starting at <span class="math inline">\(X(0) = 0\)</span>, but with <span class="math inline">\(\delta \in \{ \frac{1}{8}, \frac{1}{2}, 2 \}\)</span>, respectively. Recall that <span class="math inline">\(| X(t+1) - X(t) | \le \delta\)</span>. Thus the trajectories are decreasingly smooth.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-nrw-trajectory" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nrw-trajectory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simulation_files/figure-html/fig-nrw-trajectory-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nrw-trajectory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: X(t) with small to large jumps
</figcaption>
</figure>
</div>
</div>
</div>
<p>Next we see histograms of the generated values. For the first and smoothest series more time would have been needed to traverse a greater portion of the normal distribution values.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-nrw-hist" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nrw-hist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simulation_files/figure-html/fig-nrw-hist-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nrw-hist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: Histograms of X(t) with small to large jumps
</figcaption>
</figure>
</div>
</div>
</div>
<p>Comparing the sets of summary statistics below, we see that the first random walk was confined to a narrower range of values. The final column is the effective sample size estimated by <code>R</code> function <code>astsa::ESS()</code>.</p>
<div id="tbl-nrw-smy" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-nrw-smy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.3: Summary statistics: normal random walks
</figcaption>
<div aria-describedby="tbl-nrw-smy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  d_idx   min    q_1    avg    q_3   max    sd     n    ess
  &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
1 1     -2.07 -1.54  -0.995 -0.505 0.525 0.650  1024   4.07
2 2     -3.06 -1.12  -0.303  0.601 2.53  1.10   1024  15.6 
3 3     -3.37 -0.773 -0.151  0.555 3.23  0.985  1024 212.  </code></pre>
</div>
</div>
</figure>
</div>
</section>
</section>
</section>
<section id="sec-team-exr" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="sec-team-exr"><span class="header-section-number">4.7</span> Team Exercises</h2>
<ol type="1">
<li>As in the class exercise, generate <span class="math inline">\(R\)</span> samples, each a sample of size <span class="math inline">\(n\)</span>, but this time use the Cauchy distribution (<code>rcauchy()</code>) rather than normal distribution (<code>rnorm()</code>). Calculate the sample variance and construct a histogram of the <span class="math inline">\(R\)</span> sample means:</li>
</ol>
<p><span id="eq-sim-sample-mean"><span class="math display">\[
\left\{ \hat{\mu}_r \right\}_{r = 1}^R
\qquad(4.21)\]</span></span></p>
<ol start="2" type="1">
<li><p>Suppose <span class="math inline">\((U_1, \ldots, U_n)\)</span> are independent and identically distributed random variables following the standard uniform distribution on the interval <span class="math inline">\((0, 1)\)</span>. Now set <span class="math inline">\(X_j = - \log_e(U_j)\)</span> for <span class="math inline">\(j = 1, \ldots, n\)</span>. What is the distribution of <span class="math inline">\((X_1, \ldots, X_n)\)</span>?</p></li>
<li><p>In the Monte Carlo illustration of <a href="#sec-est-pi" class="quarto-xref"><span>Section 4.5.1</span></a>, what is the standard error of estimate of <span class="math inline">\(\pi\)</span>?</p></li>
</ol>
</section>
<section id="resources" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="resources"><span class="header-section-number">4.8</span> Resources</h2>
<p><a href="https://www.google.co.uk/books/edition/Statistical_Distributions/OA4AJZsnOpMC?hl=en">Statistical Distributions</a> by Forbes, Evans, Hastings, and Peacock</p>
<p><a href="https://www.google.co.uk/books/edition/_/NSzEtAEACAAJ?hl=en&amp;sa=X&amp;ved=2ahUKEwiMpLHk3uiKAxUF9bsIHcSpBaIQre8FegQIGhAC">Distributions in Statistics</a> by Johnson and Kotz</p>
<p><a href="https://bookdown.org/rdpeng/advstatcomp/">Advanced Statistical Computing</a> by Roger Peng</p>
<p><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Random.html">R: Random Number Generation</a></p>
<p><a href="https://en.wikipedia.org/wiki/Monte_Carlo_method">Monte Carlo method - Wikipedia</a></p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Tokdar_Kass_2010" class="csl-entry" role="listitem">
Tokdar, Surya T., and Robert E. Kass. 2010. <span>“Importance Sampling: A Review.”</span> <em>WIREs Computational Statistics</em> 2 (1): 54–60. https://doi.org/<a href="https://doi.org/10.1002/wics.56">https://doi.org/10.1002/wics.56</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>See <span class="citation" data-cites="Rrng">(<a href="references.html#ref-Rrng" role="doc-biblioref"><strong>Rrng?</strong></a>)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>See <span class="citation" data-cites="forbes2010statistical">(<a href="references.html#ref-forbes2010statistical" role="doc-biblioref"><strong>forbes2010statistical?</strong></a>)</span> and <span class="citation" data-cites="johnson1985distributions">(<a href="references.html#ref-johnson1985distributions" role="doc-biblioref"><strong>johnson1985distributions?</strong></a>)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>See <span class="citation" data-cites="Tokdar_Kass_2010">Tokdar and Kass (<a href="references.html#ref-Tokdar_Kass_2010" role="doc-biblioref">2010</a>)</span>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>If <span class="math inline">\(Y_\nu = 12 | Z_\nu |\)</span>, then the probability that <span class="math inline">\(Y_\nu \ge 6\)</span> is about 0.62.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>See <span class="citation" data-cites="rdpeng2022advstatcomp">(<a href="references.html#ref-rdpeng2022advstatcomp" role="doc-biblioref"><strong>rdpeng2022advstatcomp?</strong></a>)</span><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>A unique, stationary distribution exists if the chain is aperiodic, and if all states communicate and are positive recurrent. For further details see the <a href="https://en.wikipedia.org/wiki/Discrete-time_Markov_chain#Stationary_distributions">Wikipedia article</a>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>See <span class="citation" data-cites="MH_algo_Wikipedia_2025">(<a href="references.html#ref-MH_algo_Wikipedia_2025" role="doc-biblioref"><strong>MH_algo_Wikipedia_2025?</strong></a>)</span>.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/github\.com\/tthrall\/eda4ml\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./clustering.html" class="pagination-link" aria-label="Clustering: EDA in Higher Dimensions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Clustering: EDA in Higher Dimensions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./study-design.html" class="pagination-link" aria-label="Sampling and Study Design">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Sampling and Study Design</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/tthrall/eda4ml/edit/main/simulation.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/tthrall/eda4ml/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>